<aside class="side-control-panel">
    <!-- Settings Bars for Controls -->
    <nav class="side-settings-bar">
        <div class="settings-bar-divs text-size-bar">
            <img id="text-size-icon" alt="Text Size" class="nav-icon" data-sidebar-icon data-icon-key="text-size">
            <span class="settings-titles">Text Size</span>
            <div class="settings-buttons">
                <button class="size-btn" data-size="small">Small</button>
                <button class="size-btn active" data-size="medium">Medium</button>
                <button class="size-btn" data-size="large">Large</button>
            </div>
        </div>
        <div class="settings-bar-divs sound-bar">
            <img id="sounds-icon" alt="Sounds" class="nav-icon" data-sidebar-icon data-icon-key="sounds">
            <span class="settings-titles">Sounds</span>
            <div class="settings-buttons">
                <button class="sound-btn active" data-sound="on">On</button>
                <button class="sound-btn" data-sound="off">Off</button>
            </div>
        </div>
        <div class="settings-bar-divs music-bar">
            <img id="music-icon" alt="Music" class="nav-icon" data-sidebar-icon data-icon-key="music">
            <span class="settings-titles">Music</span>
            <div class="settings-buttons">
                <button class="music-btn active" data-music="on">On</button>
                <button class="music-btn" data-music="off">Off</button>
            </div>
            <button class="skip-btn">
                Skip
            </button>
        </div>
        <div class="settings-bar-divs particles-bar">
            <img id="particles-icon" alt="Particles" class="nav-icon" data-sidebar-icon data-icon-key="particles">
            <span class="settings-titles">Particles</span>
            <div class="settings-buttons">
                <button class="particle-btn active" data-particles="on">On</button>
                <button class="particle-btn" data-particles="off">Off</button>
            </div>
        </div>
        <div class="settings-bar-divs fish-bar">
            <img id="fish-icon" alt="Fish" class="nav-icon" data-sidebar-icon data-icon-key="fish">
            <span class="settings-titles">Fish</span>
            <div class="settings-buttons">
                <button class="fish-btn active" data-fish="on">On</button>
                <button class="fish-btn" data-fish="off">Off</button>
            </div>
        </div>
    </nav>
</aside>

<script>
// Load sidebar icons from config
async function loadSidebarIcons() {
    console.log('loadSidebarIcons called, iconConfig:', window.iconConfig)
    
    if (!window.iconConfig) {
        console.log('iconConfig not ready, retrying in 100ms')
        setTimeout(loadSidebarIcons, 100)
        return
    }

    try {
        console.log('Loading sidebar icons...')
        var iconKeys = ['text-size', 'sounds', 'music', 'particles', 'fish']
        var basePath = window.location.pathname.includes('/pages/') ? '../' : ''
        
        console.log('Base path:', basePath)

        // Wait for config to be loaded
        await window.iconConfig.load()
        console.log('Config loaded')

        for (var i = 0; i < iconKeys.length; i++) {
            var key = iconKeys[i]
            var el = document.getElementById(key + '-icon')
            console.log('Processing icon:', key, 'Element:', el)
            
            if (!el) {
                console.warn('Element not found for:', key)
                continue
            }

            try {
                // Get icon from config
                var iconData = await window.iconConfig.getIcon('sidebar', key)
                console.log('Icon data for', key, ':', iconData)
                
                if (iconData && iconData.icon) {
                    var encodedPath = encodeURI(basePath + iconData.icon)
                    console.log('Setting src for', key, 'to:', encodedPath)
                    el.src = encodedPath
                    el.style.display = 'block'
                    console.log('âœ“ Icon set successfully for', key)
                } else {
                    console.warn('Icon data invalid for:', key, iconData)
                }
            } catch (err) {
                console.error('Error processing icon:', key, err)
            }
        }
    } catch (err) {
        console.error('Error in loadSidebarIcons:', err)
    }
}

// Start loading when ready
console.log('Sidebar script executing, document ready state:', document.readyState)
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOMContentLoaded fired')
        loadSidebarIcons()
    })
} else {
    console.log('Calling loadSidebarIcons immediately')
    loadSidebarIcons()
}

// Also listen for config ready event
window.addEventListener('iconConfigReady', function() {
    console.log('iconConfigReady event fired')
    loadSidebarIcons()
})
</script>
